<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prefects' Guild - Eheliyagoda Central College</title>
    <link rel="icon" href="meroon Transparent logo prefect.png" type="image/png">
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.13/main.min.css' rel='stylesheet' />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap');

        :root {
            --primary-color: #8C1C13;
            --secondary-color: #C6A98F;
            --text-color: #3b3b3b;
            --text-light: #5f5f5f;
            --card-bg-color: #FFFAF0;
            --light-text-color: #ffffff;
            --glass-bg: rgba(255, 250, 240, 0.7);
        }

        html { scroll-behavior: smooth; }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            color: var(--text-color);
            background: linear-gradient(135deg, #FFFBF5 0%, #FFF5E1 100%);
            background-attachment: fixed;
        }
        
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--card-bg-color); display: flex; justify-content: center; align-items: center; z-index: 9999; transition: opacity 0.5s ease-out, visibility 0.5s ease-out; text-align: center; }
        #loader img { width: 100px; height: 100px; animation: pulsate 1.5s ease-in-out infinite; margin-bottom: 1rem; }
        #loader-text { color: var(--primary-color); font-weight: 600; font-size: 1.2rem; margin: 0; }
        @keyframes pulsate { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        #loader.hidden { opacity: 0; visibility: hidden; }

        .portfolio-header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; background-color: rgba(255, 250, 240, 0.8); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); box-shadow: 0 4px 12px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 998; border-bottom: 1px solid rgba(0,0,0,0.1); }
        .portfolio-header-left { display: flex; align-items: center; }
        .portfolio-header h1 { margin: 0; font-size: 1.5rem; color: var(--primary-color); }
        .main-nav ul { margin: 0; padding: 0; list-style: none; display: flex; }
        .main-nav li { margin-left: 2rem; }
        .main-nav a { color: var(--text-color); text-decoration: none; font-weight: 600; padding-bottom: 5px; border-bottom: 2px solid transparent; transition: color 0.3s, border-color 0.3s; }
        .main-nav a:hover { color: var(--primary-color); border-color: var(--primary-color); }
        .header-right { display: flex; align-items: center; }
        .login-btn { background-color: var(--primary-color); color: var(--light-text-color); border: none; padding: 0.6rem 1.5rem; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.2s ease-in-out; text-transform: uppercase; }
        .login-btn:hover { background-color: #70160F; transform: translateY(-2px); }
        #menu-toggle { display: none; }

        .hero-section { display: flex; align-items: center; padding: 4rem 2rem; min-height: 80vh; background-color: transparent; }
        .hero-content { flex: 1; padding-right: 3rem; }
        .hero-greeting { font-size: 1.2rem; font-weight: 600; color: var(--text-light); margin: 0; }
        .hero-title { font-size: 4rem; font-weight: 800; color: var(--primary-color); margin: 0.5rem 0; line-height: 1.2; }
        .hero-divider { width: 80px; height: 4px; background-color: var(--primary-color); margin: 1.5rem 0; }
        .hero-description { font-size: 1.1rem; line-height: 1.7; color: var(--text-light); }
        .hero-image { flex: 1; text-align: center; }
        .hero-image img { max-width: 100%; height: auto; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }

        .portfolio-container { max-width: 1200px; margin: auto; padding: 2rem; }
        .portfolio-section { background: var(--glass-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.3); padding: 2.5rem; margin-bottom: 2rem; border-radius: 20px; box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1); }
        .portfolio-section h3 { font-size: 2rem; color: var(--primary-color); text-align: center; margin-top: 0; margin-bottom: 2rem; }
        
        .prefects-layout { display: flex; gap: 2rem; }
        .prefects-sidebar { flex: 0 0 220px; }
        .prefects-sidebar h4 { margin-top: 0; color: var(--primary-color); border-bottom: 2px solid var(--secondary-color); padding-bottom: 0.5rem; }
        #category-filter-list { list-style: none; padding: 0; margin: 0; }
        #category-filter-list li button { width: 100%; padding: 0.8rem 1rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid transparent; background-color: rgba(0,0,0,0.02); text-align: left; font-weight: 600; font-size: 1rem; cursor: pointer; transition: all 0.3s; }
        #category-filter-list li button:hover { background-color: var(--secondary-color); color: var(--primary-color); }
        #category-filter-list li button.active { background-color: var(--primary-color); color: white; }
        .prefects-main-content { flex: 1; }
        .prefects-controls { margin-bottom: 1.5rem; }
        .prefects-controls input { width: 100%; box-sizing: border-box; padding: 0.8rem; border-radius: 8px; border: 1px solid #ddd; font-size: 1rem; }
        
        .prefects-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1.5rem; }
        .prefect-card { background: #fff; border-radius: 12px; padding: 1rem; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.08); transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .prefect-card:hover { transform: translateY(-8px); box-shadow: 0 10px 30px rgba(0,0,0,0.12); }
        .prefect-card img { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--secondary-color); }
        .prefect-card h4 { margin: 0.8rem 0 0.2rem; font-size: 1rem; color: var(--text-color); }
        .prefect-card p { margin: 0; color: var(--primary-color); font-weight: 600; font-size: 0.9rem; }

        .show-more-container { text-align: center; margin-top: 2rem; display: flex; justify-content: center; gap: 1rem; }
        #show-more-btn, #show-less-btn { background-color: var(--primary-color); color: var(--light-text-color); border: none; padding: 0.8rem 2rem; border-radius: 8px; font-weight: 700; font-size: 1rem; cursor: pointer; text-transform: uppercase; display: none; transition: all 0.3s; }
        #show-more-btn:hover, #show-less-btn:hover { background-color: #70160F; }
        #show-less-btn { background-color: transparent; color: var(--primary-color); border: 2px solid var(--primary-color); }
        #show-less-btn:hover { background-color: var(--primary-color); color: var(--light-text-color); }

        .portfolio-footer { text-align: center; padding: 2rem; background: var(--card-bg-color); color: var(--text-light); border-top: 1px solid #eee; }

        .animate-on-scroll { opacity: 0; transform: translateY(30px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
        .animate-on-scroll.is-visible { opacity: 1; transform: translateY(0); }

        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); }
        .modal-content-wrapper { display: flex; justify-content: center; align-items: center; min-height: 100%; }
        #auth-container { position: relative; }
        .close-button { position: absolute; top: 10px; right: 25px; color: #aaa; font-size: 32px; font-weight: bold; cursor: pointer; }
        .close-button:hover { color: black; }
        .auth-card { background-color: var(--card-bg-color); padding: 2.5rem; border-radius: 20px; box-shadow: 0 10px 35px rgba(0, 0, 0, 0.1); width: 100%; max-width: 420px; margin: 1rem; }
        .input-group { margin-bottom: 1.5rem; text-align: left; }
        .input-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #555; }
        .input-group input, .input-group select, textarea { width: 100%; padding: 0.85rem; border: 1px solid #E0E0E0; border-radius: 8px; box-sizing: border-box; background-color: var(--input-bg-color); box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); transition: all 0.3s; }
        .input-group input:focus, .input-group select:focus, textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 8px rgba(140, 28, 19, 0.2); }
        .btn { width: 100%; padding: 0.9rem; background: var(--primary-color); color: var(--light-text-color); border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.2s; text-transform: uppercase; }
        .btn:hover { transform: translateY(-3px); background-color: #70160F; }

        #main-app { display: none; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 2rem; background-color: var(--primary-color); color: var(--light-text-color); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .header-left-content { display: flex; align-items: center; }
        .header h2 { color: var(--light-text-color); font-size: 1.5rem; }
        #logout-btn { background-color: rgba(255,255,255,0.9); border: none; color: var(--primary-color); padding: 0.6rem 1.2rem; border-radius: 8px; cursor: pointer; font-weight: 700; transition: all 0.2s; text-transform: uppercase; }
        #logout-btn:hover { background-color: #fff; transform: translateY(-2px); }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }
        .page-content { margin-top: 2rem; display: none; }
        .page-content.active { display: block; }
        .card { background-color: var(--card-bg-color); padding: 1.5rem; border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); border: 1px solid rgba(255, 255, 255, 0.6); }
        .card h3 { color: var(--primary-color); border-bottom: 2px solid var(--secondary-color); padding-bottom: 0.5rem; margin-bottom: 1rem; font-size: 1.2rem; }
        .nav { display: flex; justify-content: center; background-color: rgba(255,255,255,0.2); padding: 0.5rem; margin-bottom: 0; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .nav a { color: var(--primary-color); text-decoration: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; transition: all 0.3s; }
        .nav a.active, .nav a:hover { background-color: var(--primary-color); color: #fff; }
        .container { padding: 2rem; }
        
        @media (max-width: 992px) {
            .main-nav { display: none; position: absolute; top: 100%; left: 0; width: 100%; background-color: var(--card-bg-color); box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 100; }
            .main-nav.mobile-nav-active { display: block; }
            .main-nav ul { flex-direction: column; padding: 1rem 0; }
            .main-nav li { margin: 0; text-align: center; }
            .main-nav a { display: block; padding: 1rem; border: none; }
            #menu-toggle { display: block; background: none; border: none; color: var(--primary-color); font-size: 2rem; cursor: pointer; margin-left: 1rem; }
            .portfolio-header { justify-content: space-between; }
        }
        @media (max-width: 768px) {
            .hero-section { flex-direction: column; text-align: center; padding: 2rem 1rem; }
            .hero-content { padding-right: 0; margin-bottom: 2rem; }
            .hero-divider { margin-left: auto; margin-right: auto; }
            .hero-title { font-size: 2.5rem; }
            .container, .portfolio-container { padding: 1rem; }
            .prefects-layout { flex-direction: column; }
            .prefects-sidebar { flex: 0 0 auto; margin-bottom: 2rem; }
            #category-filter-list { display: flex; flex-wrap: wrap; gap: 0.5rem; }
            #category-filter-list li button { width: auto; }
            #main-app .header { flex-direction: column; padding: 1rem; text-align: center; }
            #main-app .header-left-content { margin-bottom: 1rem; }
            #attendance-table thead { display: none; }
            #attendance-table tr { margin-bottom: 1.5rem; border: 1px solid #ddd; border-radius: 8px; padding: 1rem; background-color: rgba(255,255,255,0.5); }
            #attendance-table, #attendance-table tbody, #attendance-table tr, #attendance-table td { display: block; width: 100%; }
            #attendance-table td { text-align: right; position: relative; padding-left: 50%; padding-top: 8px; padding-bottom: 8px; border-bottom: 1px dotted #ccc; }
            #attendance-table td:last-child { border-bottom: none; }
            #attendance-table td::before { content: attr(data-label); position: absolute; left: 10px; width: calc(50% - 20px); text-align: left; font-weight: bold; color: var(--primary-color); }
        }
    </style>
</head>
<body>

    <div id="loader">
        <div>
            <img src="meroon Transparent logo prefect.png" alt="Loading...">
            <p id="loader-text">Loading...</p>
        </div>
    </div>

    <div id="public-portfolio">
        <header class="portfolio-header">
            <div class="portfolio-header-left">
                <img src="meroon Transparent logo prefect.png" alt="School Logo" style="height: 50px; margin-right: 15px;">
                <h1>ECC Prefects' Guild</h1>
            </div>
            <div class="header-right">
                <nav class="main-nav" id="main-nav">
                    <ul>
                        <li><a href="#">Home</a></li>
                        <li><a href="#vision-mission">About Us</a></li>
                        <li><a href="#prefects-list">Our Prefects</a></li>
                        <li><a href="#gallery">Gallery</a></li>
                        <li><a href="#contact">Contact Us</a></li>
                    </ul>
                </nav>
                <button id="show-login-modal-btn" class="login-btn">Login</button>
                <button id="menu-toggle">&#9776;</button>
            </div>
        </header>

        <section class="hero-section animate-on-scroll" id="hero">
            <div class="hero-content">
                <p class="hero-greeting">Welcome to the</p>
                <h2 class="hero-title">ECC PREFECTS' GUILD</h2>
                <div class="hero-divider"></div>
                <p class="hero-description">Leading with integrity and dedication. We are committed to upholding the values of our college and serving the student community.</p>
            </div>
            <div class="hero-image">
                <img src="edit 2.jpg" alt="Eheliyagoda Central College Prefects' Guild">
            </div>
        </section>

        <div class="portfolio-container">
            <section id="vision-mission" class="portfolio-section animate-on-scroll">
                <h3>About Us: Vision & Mission</h3>
                <p>Our vision is to uphold the discipline and values of Eheliyagoda Central College, fostering a positive and respectful environment for all students. We strive to be role models of integrity, responsibility, and leadership. The Prefects' Guild is actively involved in organizing school events, maintaining discipline, and assisting the academic staff.</p>
            </section>

            <section id="prefects-list" class="portfolio-section animate-on-scroll">
                <div class="prefects-layout">
                    <div class="prefects-sidebar">
                        <h4>Categories</h4>
                        <ul id="category-filter-list"></ul>
                    </div>
                    <div class="prefects-main-content">
                         <div class="prefects-controls">
                            <input type="search" id="prefect-search-bar" placeholder="Search by name...">
                        </div>
                        <div id="prefects-grid" class="prefects-grid"></div>
                        <div class="show-more-container">
                            <button id="show-more-btn">Show More</button>
                            <button id="show-less-btn">Show Less</button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="gallery" class="portfolio-section animate-on-scroll">
                <h3>Gallery</h3>
                <div class="prefects-grid">
                    <img src="https://via.placeholder.com/300x200.png?text=Event+1" style="width: 100%; border-radius: 8px;">
                    <img src="https://via.placeholder.com/300x200.png?text=Event+2" style="width: 100%; border-radius: 8px;">
                    <img src="https://via.placeholder.com/300x200.png?text=Event+3" style="width: 100%; border-radius: 8px;">
                    <img src="https://via.placeholder.com/300x200.png?text=Event+4" style="width: 100%; border-radius: 8px;">
                </div>
            </section>

            <section id="contact" class="portfolio-section animate-on-scroll">
                <h3>Contact Us</h3>
                <p style="text-align: center;">If you have any inquiries, please feel free to reach out to us.</p>
                <ul style="list-style: none; padding: 0; text-align: center; line-height: 2;">
                    <li><strong>Address:</strong> Eheliyagoda Central College, Eheliyagoda, Sri Lanka</li>
                    <li><strong>Email:</strong> <a href="mailto:info@ecc.lk">info@ecc.lk</a></li>
                    <li><strong>Phone:</strong> +94 XX XXX XXXX</li>
                </ul>
            </section>
        </div>

        <footer class="portfolio-footer">
            <p>&copy; 2025 Eheliyagoda Central College Prefects' Guild. All Rights Reserved.</p>
        </footer>
    </div>

    <div id="login-modal" class="modal">
        <div class="modal-content-wrapper">
             <div id="auth-container">
                <span class="close-button" id="close-login-modal-btn">&times;</span>
                <div id="login-view" class="auth-card">
                    <img src="meroon Transparent logo prefect.png" alt="School Logo" style="height: 80px; margin-bottom: 10px; display: block; margin-left: auto; margin-right: auto;">
                    <h2>Eheliyagoda Central College</h2>
                    <h3>Prefects' Login Portal</h3>
                    <form id="login-form"><div class="input-group"><label for="email">Email Address</label><input type="email" id="email" required></div><div class="input-group"><label for="password">Password</label><input type="password" id="password" required></div><button type="submit" class="btn">Login</button></form>
                    <p>Don't have an account? <a href="#" id="show-register">Register here</a></p>
                </div>
                <div id="register-view" class="auth-card" style="display: none;">
                    <img src="meroon Transparent logo prefect.png" alt="School Logo" style="height: 80px; margin-bottom: 10px; display: block; margin-left: auto; margin-right: auto;">
                    <h2>Eheliyagoda Central College</h2><h3>Prefects' Registration Portal</h3>
                    <form id="register-form"><div class="input-group"><label for="register-email">Email</label><input type="email" id="register-email" required></div><div class="input-group"><label for="register-password">Password</label><input type="password" id="register-password" required></div><div class="input-group"><label for="barcode_id">Unique ID</label><input type="text" id="barcode_id" required></div><button type="submit" class="btn">Register</button></form>
                    <p>Already have an account? <a href="#" id="show-login">Login here</a></p>
                </div>
            </div>
        </div>
    </div>

    <div id="main-app">
        <div class="header">
            <div class="header-left-content">
                <img src="meroon Transparent logo prefect.png" alt="School Logo" style="height: 50px; margin-right: 15px;">
                <h2>ECC PREFECTS' GUILD</h2>
            </div>
            <button id="logout-btn">Logout</button>
        </div>
        <div class="nav">
            <a href="#" data-page="dashboard" class="nav-link active">Dashboard</a>
            <a href="#" data-page="attendance" class="nav-link">Attendance</a>
            <a href="#" data-page="ideas" class="nav-link">Ideas & Proposals</a>
            <a href="#" data-page="warnings" class="nav-link">Warning Letters</a>
            <a href="#" data-page="announcements" class="nav-link">Announcements</a>
            <a href="#" data-page="calendar" class="nav-link">Duty Roster</a>
        </div>
        <div class="container">
            <div id="dashboard-page" class="page-content active">
                <div class="dashboard-grid">
                    <div class="card"><img id="prefect-picture" src="https://via.placeholder.com/150" alt="Profile Picture" style="width: 100px; height: 100px; border-radius: 50%; margin-bottom: 10px; display: block;"><h3>Welcome, <span id="prefect-name"></span></h3><p><strong>Role:</strong> <span id="prefect-role"></span></p><p><strong>Class:</strong> <span id="prefect-class"></span></p></div>
                    <div class="card"><h3>Key Stats</h3><p><strong>Total Points:</strong> <span id="total-points"></span></p><p><strong>Absences:</strong> <span id="total-absences"></span></p><p><strong>Late Arrivals:</strong> <span id="total-lates"></span></p></div>
                    <div class="card"><h3>Recent Attendance</h3><ul id="attendance-list" style="list-style: none; padding: 0;"></ul></div>
                    <div class="card"><h3>Recent Points</h3><ul id="points-list" style="list-style: none; padding: 0;"></ul></div>
                </div>
            </div>
            <div id="attendance-page" class="page-content">
                <div class="card"><h3>Your Attendance Record</h3><table id="attendance-table" style="width: 100%; border-collapse: collapse;"><thead><tr style="text-align: left; border-bottom: 2px solid var(--primary-color);"><th style="padding: 8px;">Date</th><th style="padding: 8px;">Status</th><th style="padding: 8px;">Time</th><th style="padding: 8px;">Reason</th></tr></thead><tbody></tbody></table></div>
            </div>
            <div id="ideas-page" class="page-content"><div class="card"><h3>Submit a New Idea</h3><form id="idea-form"><div class="input-group"><textarea id="idea-text" placeholder="Write your idea..." required rows="5"></textarea></div><button type="submit" class="btn">Submit Idea</button></form></div><div class="card"><h3>Your Submitted Ideas</h3><ul id="ideas-list" style="list-style: none; padding: 0;"></ul></div></div>
            <div id="warnings-page" class="page-content"><div class="card"><h3>Your Warning Letters</h3><ul id="warnings-list" style="list-style: none; padding: 0;"></ul></div></div>
            <div id="announcements-page" class="page-content"><div class="card"><h3>Announcement History</h3><ul id="announcements-list" style="list-style: none; padding: 0;"></ul></div></div>
            <div id="calendar-page" class="page-content"><div class="card"><h3>Duty Roster</h3><div id='calendar'></div></div></div>
        </div>
    </div>
    <div id="reason-modal" class="modal"><div class="modal-content-wrapper"><div class="auth-card"><span class="close-button">&times;</span><h3>Provide a reason</h3><form id="reason-form"><div class="input-group"><label for="reason-select">Reason</label><select id="reason-select"><option value="">Select...</option><option value="Sick">Sick</option><option value="Other">Other</option></select></div><div class="input-group"><input type="text" id="other-reason-text" placeholder="Please specify" style="display: none;"></div><input type="hidden" id="attendance-doc-id"><button type="submit" class="btn">Submit</button></form></div></div></div>
    <div id="announcement-modal" class="modal"><div class="modal-content-wrapper"><div class="auth-card"><span class="close-button">&times;</span><h2 id="announcement-title"></h2><p id="announcement-content"></p></div></div></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-auth.js";
        import { getFirestore, collection, getDocs, doc, setDoc, updateDoc, where, query } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-firestore.js";
        
        let loaderInterval;
        window.onload = () => {
            const loader = document.getElementById('loader');
            if(loader) loader.classList.add('hidden');
            if (loaderInterval) clearInterval(loaderInterval);
        };

        const firebaseConfig = {
            apiKey: "AIzaSyCEvF1sD56pmtYlbno4QAY_Kr5xeFrTAvU",
            authDomain: "prefect-management-syste-e1575.firebaseapp.com",
            projectId: "prefect-management-syste-e1575",
            storageBucket: "prefect-management-syste-e1575.appspot.com",
            messagingSenderId: "973932803095",
            appId: "1:973932803095:web:a7f2db386cafb53330d852",
            measurementId: "G-FLF7R3B8J3"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const loaderText = document.getElementById('loader-text');
        if (loaderText) {
            const messages = ["Loading...", "Initializing...", "Please Wait...", "Almost Done..."];
            let messageIndex = 0;
            loaderInterval = setInterval(() => {
                loaderText.textContent = messages[messageIndex];
                messageIndex = (messageIndex + 1) % messages.length;
            }, 1800);
        }

        const animatedElements = document.querySelectorAll('.animate-on-scroll');
        if (window.IntersectionObserver) {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });
            animatedElements.forEach(el => observer.observe(el));
        }

        const menuToggle = document.getElementById('menu-toggle');
        const mainNav = document.getElementById('main-nav');
        if(menuToggle && mainNav) {
            menuToggle.addEventListener('click', () => mainNav.classList.toggle('mobile-nav-active'));
            mainNav.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => mainNav.classList.remove('mobile-nav-active'));
            });
        }
        
        const publicPortfolio = document.getElementById('public-portfolio');
        const mainApp = document.getElementById('main-app');
        const loginModal = document.getElementById('login-modal');
        const showLoginModalBtn = document.getElementById('show-login-modal-btn');
        const closeLoginModalBtn = document.getElementById('close-login-modal-btn');
        const loginView = document.getElementById('login-view');
        const registerView = document.getElementById('register-view');
        const showRegister = document.getElementById('show-register');
        const showLogin = document.getElementById('show-login');

        if(showLoginModalBtn) showLoginModalBtn.addEventListener('click', () => { if(loginModal) loginModal.style.display = 'block'; });
        if(closeLoginModalBtn) closeLoginModalBtn.addEventListener('click', () => { if(loginModal) loginModal.style.display = 'none'; });
        window.addEventListener('click', (event) => { if (event.target == loginModal) loginModal.style.display = "none"; });
        if(showRegister) showRegister.addEventListener('click', (e) => { e.preventDefault(); if(loginView && registerView) { loginView.style.display = 'none'; registerView.style.display = 'block'; } });
        if(showLogin) showLogin.addEventListener('click', (e) => { e.preventDefault(); if(loginView && registerView) { registerView.style.display = 'none'; loginView.style.display = 'block'; } });

        let fetchedPrefects = [];
        const prefectsGrid = document.getElementById('prefects-grid');
        const searchBar = document.getElementById('prefect-search-bar');
        const categoryFilterList = document.getElementById('category-filter-list');
        const showMoreBtn = document.getElementById('show-more-btn');
        const showLessBtn = document.getElementById('show-less-btn');
        let currentCategory = 'All';
        const initialVisibleCount = 10;
        let visiblePrefectCount = initialVisibleCount;

        async function loadAndDisplayPrefects() {
            if (!prefectsGrid) return;
            prefectsGrid.innerHTML = '<p>Loading Prefects...</p>';
            try {
                const prefectsCollection = collection(db, "prefects");
                const querySnapshot = await getDocs(prefectsCollection);
                fetchedPrefects = [];
                querySnapshot.forEach((doc) => fetchedPrefects.push(doc.data()));
                populateCategories();
                renderPrefects();
            } catch (error) {
                console.error("Error fetching prefects: ", error);
                prefectsGrid.innerHTML = `<p>Error loading prefects. Check console for details.</p>`;
            }
        }

        function populateCategories() { /* Unchanged */ }
        function renderPrefects() { /* Unchanged */ }
        
        if (prefectsGrid) {
            searchBar.addEventListener('input', () => { visiblePrefectCount = initialVisibleCount; renderPrefects(); });
            categoryFilterList.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    visiblePrefectCount = initialVisibleCount;
                    currentCategory = e.target.dataset.category;
                    categoryFilterList.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    renderPrefects();
                }
            });
            showMoreBtn.addEventListener('click', () => { visiblePrefectCount = fetchedPrefects.length; renderPrefects(); });
            showLessBtn.addEventListener('click', () => {
                visiblePrefectCount = initialVisibleCount;
                renderPrefects();
                const prefectsListSection = document.getElementById('prefects-list');
                if (prefectsListSection) prefectsListSection.scrollIntoView({ behavior: 'smooth' });
            });
            loadAndDisplayPrefects();
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                if(publicPortfolio) publicPortfolio.style.display = 'none';
                if(loginModal) loginModal.style.display = 'none';
                if(mainApp) mainApp.style.display = 'block';
                initializeDashboard(user, db, auth);
            } else {
                if(publicPortfolio) publicPortfolio.style.display = 'block';
                if(mainApp) mainApp.style.display = 'none';
                if(loginModal) loginModal.style.display = 'none';
            }
        });

        const loginForm = document.getElementById('login-form');
        if(loginForm) loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            signInWithEmailAndPassword(auth, email, password).catch((error) => alert(error.message));
        });
        
        function initializeDashboard(user, db, auth) {
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    signOut(auth).catch((error) => console.error('Sign out error', error));
                });
            }
        }
    </script>
</body>
</html>
